RewriteEngine On

# Force PHP processing for .php files
AddType application/x-httpd-php .php
AddHandler php7-script .php

# Prevent direct access to app.php (only allow POST requests)
<Files "app.php">
    <RequireAll>
        Require expr %{REQUEST_METHOD} == 'POST'
    </RequireAll>
</Files>

# Prevent access to config files
<Files ~ "config\.php$">
    Require all denied
</Files>

# Prevent access to sensitive files
<Files ~ "\.(log|env|ini|example)$">
    Require all denied
</Files>

# Redirect root to he-opas.html (landing page)
RewriteRule ^$ he-opas.html [QSA,L]

# Allow direct access to HTML files
RewriteCond %{REQUEST_URI} \.(html)$
RewriteRule ^(.*)$ $1 [L]

# Redirect form submissions to app.php
RewriteCond %{REQUEST_METHOD} POST
RewriteRule ^(.*)$ app.php [QSA,L]

# Security headers
<IfModule mod_headers.c>
    Header always set X-Content-Type-Options nosniff
    Header always set X-Frame-Options DENY
    Header always set X-XSS-Protection "1; mode=block"
    Header always set Referrer-Policy "strict-origin-when-cross-origin"
    Header always set Permissions-Policy "geolocation=(), microphone=(), camera=()"
</IfModule>

# Disable directory browsing
Options -Indexes
